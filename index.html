<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Styalo TR Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 50px; }
#tr { font-size: 2em; margin-bottom: 20px; }
canvas { max-width: 90%; height: 300px; }
</style>
</head>
<body>
<h1>Styalo TR Tracker</h1>
<div id="tr">Loading...</div>
<canvas id="trChart"></canvas>

<script>
async function fetchTR() {
  const res = await fetch("/api/user");
  const data = await res.json();
  document.getElementById("tr").textContent = `${data.tr} TR (${data.delta >= 0 ? "+" : ""}${data.delta})`;
  drawChart(data.history);
}

function drawChart(history) {
  const ctx = document.getElementById("trChart").getContext("2d");
  const labels = history.map(h => new Date(h.ts).toLocaleDateString());
  const values = history.map(h => h.tr);

  if (window.trChart) {
    window.trChart.data.labels = labels;
    window.trChart.data.datasets[0].data = values;
    window.trChart.update();
  } else {
    window.trChart = new Chart(ctx, {
      type: 'line',
      data: { labels, datasets: [{ label: "TR", data: values, borderColor: "blue", fill: false }] },
      options: { responsive: true, maintainAspectRatio: false }
    });
  }
}

fetchTR();
</script>
</body>
</html>
